# Взаимодействия с API Dropbox

Библиотека упрощает взаимодествие с Dropbox из OneScript. Например, можно выгрузить файл бекапа базы 1С в хранилище Dropbox.

## Установка

Установка пакета через файл. Качаем последний релиз со страницы [Релизы](https://github.com/otymko/dropbox/releases "Релизы").
Затем из командной строки:
```
opm install -f dropbox*.ospx
```

## Настройка Dropbox

Для использования библиотеки, нужно сгенерировать API token. Для этого нужно:
* Создать приложение (app) в личном кабинете Dropbox [Приложения Dropbox](https://www.dropbox.com/developers/apps "Приложения Dropbox")
* Получить токен oAuth2. Для этого в строке браузера переходим:

```
https://www.dropbox.com/oauth2/authorize?client_id=<APP_KEY>&response_type=code
```
где, <APP_KEY> - ключ приложения из приложения Dropbox (App key).

Другой способ получения токена - генерация со страницы приложения Dropbox. Более подробнее [здесь](https://blogs.dropbox.com/developers/2014/05/generate-an-access-token-for-your-own-account/ "Ссылка на блок Dropbox")

## Важная информация

Для доработки библиотеки и тестирования используйте **ТЕСТОВЫЙ АККАУНТ** Dropbox.

## Примеры

### Авторизация

Для начала работы с Dropbox нужно авторизоваться через токен.

``` bsl
#Использовать dropbox

Токен = "какой-то-токен-авторизации";

Клиент = Новый Dropbox();
Клиент.УстановитьТокенАвторизации(Токен);
```

### Отправка файла в Dropbox

``` bsl
// + Авторизация 

ПутьКФайлуЛокально = ".\features\files\test.txt";
ПутьКФайлуDropbox = "/test.txt"; 

ОбъектDB = Клиент.ОтправитьФайл(ПутьКФайлуЛокально, ПутьКФайлуDropbox);
Сообщить("Идентификатор файла: " + ОбъектDB.Идентификатор);
```

или

``` bsl
// + Авторизация 

ПутьКФайлуЛокально = ".\features\files\test.txt";
ПутьКФайлуDropbox = "/test.txt"; 

ОбъектDB = Новый ОбъектDropbox();
ОбъектDB.Путь = ПутьКФайлуЛокально;
НовыйОбъектDB = Клиент.ОтправитьФайл(ОбъектDB, ПутьКФайлуDropbox);
Сообщить("Идентификатор файла: " + НовыйОбъектDB.Идентификатор);
```

### Загрузка файла из Dropbox

``` bsl
// + Авторизация 

ИмяФайлаНаСервисе = "/test.txt";
ИмяФайлаЛокально = ПолучитьИмяВременногоФайла("txt");
Клиент.ЗагрузитьФайл(ИмяФайлаНаСервисе, ИмяФайлаЛокально);
```

### Удаление файла в Dropbox
``` bsl
// + Авторизация 

ИмяФайлаНаСервисе = "/test.txt";
Клиент.УдалитьФайл(ИмяФайлаНаСервисе);
```

или

``` bsl
// + Авторизация 

ИмяФайлаНаСервисе = "/test.txt";
ОбъектDB = Новый ОбъектDropbox();
ОбъектDB.Путь = ИмяФайлаНаСервисе$ 
Клиент.УдалитьФайл(ОбъектDB);
```

### Поиск файлов в Dropbox
``` bsl
// + Авторизация 

КаталогНаСервисе = "";
ИмяФайлаПоиска = "test.txt"; 

СписокФайлов = Клиент.ПоискФайлов(ИмяФайлаПоиска, "filename", КаталогНаСервисе);
Если СписокФайлов.Количество() > 0 Тогда
    Сообщить(СписокФайлов[0].Идентификатор);
КонецЕсли;
```

## ОбъектDropbox
С помощью класса ОбъектDropbox с сервиса Dropbox доступны следующие свойства:
* Наименование (name) - имя файла
* Идентификатор (id) - идентификатор файла
* ДатаИзмененияКлиент (client_modified)
* ДатаИзмененияСервер (server_modified)
* НомерВерсии (rev)
* Размер (size) - размер в байтах
* Путь (path_lower) - путь к файлу в нижнем регистре
* ПутьПредставление (path_display) - путь к файлу
* Хэш (content_hash)